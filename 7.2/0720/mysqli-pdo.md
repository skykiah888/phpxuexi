# php 操作数据库

## 1. 基本步骤

| 序号 | 步骤             | 描述                                                |
| ---- | ---------------- | --------------------------------------------------- |
| 1    | 连接数据库       | 创建数据库连接对象的过程`$mysqli`或`$pdo`           |
| 2    | 操作数据表       | `SELECT`查询/`INSERT`新增/`UPDATE`更新/`DELETE`删除 |
| 3    | 释放结果集[可选] | 仅针对查询操作有效,清空查询结果的过程               |
| 4    | 关闭数据库连接   | 实际上是销毁数据库连接对象的过程                    |

- 写操作(INSERT/UPDATE/DELETE): 返回受影响的记录数量(整数)
- 读操作(SELECT/DESC...): 返回查询结果集(二维关联数组)

---

## 2. 连接参数

| 序号 | 参数       | 描述             |
| ---- | ---------- | ---------------- |
| 1    | `type`     | 数据库类型       |
| 2    | `host`     | 默认数据库主机名 |
| 3    | `dbname`   | 默认数据库名称   |
| 4    | `charset`  | 默认字符集       |
| 5    | `port`     | 默认端口号       |
| 6    | `username` | 默认用户名       |
| 7    | `password` | 默认用户密码     |

---

## 3. mysqli

> 仅介绍 mysqli 面向对象 + 预处理

### 3.1 `mysqli`接口

| 序号 | 属性/方法       | 描述                  |
| ---- | --------------- | --------------------- |
| 1    | `connect_errno` | 连接错误编码          |
| 2    | `connect_error` | 连接错误信息          |
| 3    | `set_charset`   | 设置字符集            |
| 4    | `prepare`       | 创建`mysqli_stmt`对象 |

### 3.2 `mysqli_stmt`接口

| 序号 | 属性/方法       | 描述                     |
| ---- | --------------- | ------------------------ |
| 1    | `bind_param()`  | 占位符与变量绑定         |
| 2    | `bind_result()` | 字段与变量绑定           |
| 3    | `execute()`     | 执行 SQL 语句            |
| 4    | `get_result()`  | 创建`mysqli_result` 对象 |
| 5    | `fetch()`       | 遍历变量中的字段         |
| 6    | `close()`       | 关闭预处理查询           |
| 7    | `affected_rows` | 受影响记录数量           |
| 8    | `insert_id`     | 新增记录主键 id          |
| 9    | `errno`         | 错误编号                 |
| 10   | `error`         | 错误信息                 |

### 3.3 `mysqli_result`接口

| 序号 | 属性/方法       | 描述                   |
| ---- | --------------- | ---------------------- |
| 1    | `fetch_assoc()` | 以关联数组返回一条记录 |
| 2    | `fetch_all()`   | 获取全部记录           |
| 3    | `num_rows`      | 结果集记录数量         |
| 4    | `free()`        | 释放结果集             |

---

## 4. pdo

> 仅介绍 pdo 预处理

### 4.1 `PDO`接口

| 序号 | 属性/方法        | 描述                   |
| ---- | ---------------- | ---------------------- |
| 1    | `setAttribute()` | 设置属性               |
| 2    | `lastInsertId()` | 最后插入记录的主键 id  |
| 3    | `prepare()`      | 创建`PDOStatement`对象 |

### 4.1 `PDOStatement`接口

> 它的实例与一条预处理语句对应, 上面定义了许多实用的方法

| 序号 | 属性/方法        | 描述                   |
| ---- | ---------------- | ---------------------- |
| 1    | `setAttribute()` | 设置属性               |
| 2    | `lastInsertId()` | 最后插入记录的主键 id  |
| 3    | `prepare()`      | 创建`PDOStatement`对象 |
